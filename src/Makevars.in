# path to taoR/lib of the installed package
rpath = @rpath@

# platform
platform = @platform@

# link to petsc
PKG_LIBS = `$(R_HOME)/bin/Rscript -e "Rcpp:::LdFlags()"` -Wl,-rpath,${rpath} -L../inst/lib -lpetsc

# add include directories so that the c code can find the headers
PKG_CXXFLAGS = -I../inst/include

all: $(SHLIB)
	@if command -v install_name_tool; then install_name_tool -change @linker@ '@rpath/libpetsc.3.6.3.dylib' taoR.so; fi
	@if [ ${platform} == "osx" ]; then rm ../inst/lib/libpetsc.dylib; rm ../inst/lib/libpetsc.3.6.dylib; fi
	@if [ ${platform} == "linux" ]; then rm ../inst/lib/libpetsc.so; rm ../inst/lib/libpetsc.so.3.6; fi 